# C4 Diagrams

C4 diagrams visualize software architecture at different levels of detail.

**Note:** C4 diagram support in Mermaid is experimental and syntax may change.

## Basic Syntax

```mermaid
C4Context
    title System Context diagram for Internet Banking System
    
    Person(customer, "Personal Banking Customer", "A customer of the bank")
    System(banking_system, "Internet Banking System", "Allows customers to view information about their bank accounts")
    System_Ext(mail_system, "E-mail system", "The internal Microsoft Exchange e-mail system")
    System_Ext(mainframe, "Mainframe Banking System", "Stores all of the core banking information")
    
    Rel(customer, banking_system, "Uses")
    Rel(banking_system, mail_system, "Sends e-mail using")
    Rel(banking_system, mainframe, "Gets account information from")
```

## Element Types

### System Context Level
- `Person(alias, label, description)` - User or actor
- `Person_Ext(alias, label, description)` - External user
- `System(alias, label, description)` - Software system
- `System_Ext(alias, label, description)` - External system
- `SystemDb(alias, label, description)` - Database system
- `SystemDb_Ext(alias, label, description)` - External database

### Container Level
- `Container(alias, label, technology, description)` - Application/container
- `ContainerDb(alias, label, technology, description)` - Database container
- `Container_Ext(alias, label, technology, description)` - External container

### Component Level
- `Component(alias, label, technology, description)` - Software component
- `ComponentDb(alias, label, technology, description)` - Database component

## Relationships

```mermaid
Rel(from, to, label)
Rel(from, to, label, technology)
BiRel(from, to, label)
BiRel(from, to, label, technology)
Rel_Back(from, to, label)
Rel_D(from, to, label)  // Down
Rel_U(from, to, label)  // Up
Rel_L(from, to, label)  // Left
Rel_R(from, to, label)  // Right
```

## Common Patterns

### System Context - Web Application
```mermaid
C4Context
    title System Context - E-Commerce Platform
    
    Person(customer, "Customer", "Browses and purchases products")
    Person(admin, "Administrator", "Manages products and orders")
    
    System(ecommerce, "E-Commerce Platform", "Online shopping system")
    
    System_Ext(payment, "Payment Gateway", "Processes credit card payments")
    System_Ext(shipping, "Shipping Provider", "Handles order fulfillment")
    System_Ext(email, "Email Service", "Sends transactional emails")
    
    Rel(customer, ecommerce, "Uses", "HTTPS")
    Rel(admin, ecommerce, "Manages", "HTTPS")
    Rel(ecommerce, payment, "Processes payments via", "API")
    Rel(ecommerce, shipping, "Creates shipments via", "API")
    Rel(ecommerce, email, "Sends emails via", "SMTP")
```

### Container Diagram - Microservices
```mermaid
C4Container
    title Container Diagram - E-Commerce Platform
    
    Person(customer, "Customer")
    
    Container(web_app, "Web Application", "React", "Provides e-commerce functionality")
    Container(mobile_app, "Mobile App", "React Native", "Provides e-commerce functionality on mobile")
    Container(api_gateway, "API Gateway", "Node.js", "Routes requests to microservices")
    
    Container(user_service, "User Service", "Java/Spring", "Handles user authentication and profiles")
    Container(product_service, "Product Service", "Node.js", "Manages product catalog")
    Container(order_service, "Order Service", "Python/Django", "Processes orders")
    
    ContainerDb(user_db, "User Database", "PostgreSQL", "Stores user information")
    ContainerDb(product_db, "Product Database", "MongoDB", "Stores product data")
    ContainerDb(order_db, "Order Database", "PostgreSQL", "Stores order data")
    
    Rel(customer, web_app, "Uses", "HTTPS")
    Rel(customer, mobile_app, "Uses", "HTTPS")
    
    Rel(web_app, api_gateway, "Makes API calls to", "JSON/HTTPS")
    Rel(mobile_app, api_gateway, "Makes API calls to", "JSON/HTTPS")
    
    Rel(api_gateway, user_service, "Routes to", "HTTP")
    Rel(api_gateway, product_service, "Routes to", "HTTP")
    Rel(api_gateway, order_service, "Routes to", "HTTP")
    
    Rel(user_service, user_db, "Reads/Writes", "SQL")
    Rel(product_service, product_db, "Reads/Writes", "MongoDB Protocol")
    Rel(order_service, order_db, "Reads/Writes", "SQL")
```

### System Context - SaaS Platform
```mermaid
C4Context
    title System Context - Project Management SaaS
    
    Person(user, "Team Member", "Uses the platform for project management")
    Person(admin, "Admin", "Manages organization and settings")
    
    System(saas_platform, "Project Management Platform", "Collaborative project management tool")
    
    System_Ext(auth_provider, "Auth0", "Handles authentication")
    System_Ext(storage, "AWS S3", "Stores file attachments")
    System_Ext(notification, "Twilio/SendGrid", "Sends notifications")
    System_Ext(analytics, "Google Analytics", "Tracks usage metrics")
    
    Rel(user, saas_platform, "Manages projects via")
    Rel(admin, saas_platform, "Configures")
    
    Rel(saas_platform, auth_provider, "Authenticates users via")
    Rel(saas_platform, storage, "Stores files in")
    Rel(saas_platform, notification, "Sends notifications via")
    Rel(saas_platform, analytics, "Sends events to")
```

### Container Diagram - Monolith to Microservices
```mermaid
C4Container
    title Container Diagram - Hybrid Architecture
    
    Person(user, "User")
    
    Container(web_ui, "Web UI", "Angular", "Single page application")
    Container(mobile, "Mobile App", "Flutter", "Native mobile app")
    
    Container(api_gateway, "API Gateway", "Kong", "API routing and auth")
    
    Container(legacy_monolith, "Legacy System", "Java Monolith", "Core business logic (being decomposed)")
    Container(new_service_1, "Order Service", "Go", "New microservice")
    Container(new_service_2, "Notification Service", "Node.js", "New microservice")
    
    ContainerDb(legacy_db, "Legacy Database", "Oracle", "Shared database")
    ContainerDb(order_db, "Order DB", "PostgreSQL", "Order service data")
    ContainerDb(cache, "Redis Cache", "Redis", "Session and cache storage")
    
    Rel(user, web_ui, "Uses")
    Rel(user, mobile, "Uses")
    
    Rel(web_ui, api_gateway, "Calls", "HTTPS")
    Rel(mobile, api_gateway, "Calls", "HTTPS")
    
    Rel(api_gateway, legacy_monolith, "Routes to", "HTTP")
    Rel(api_gateway, new_service_1, "Routes to", "HTTP")
    Rel(api_gateway, new_service_2, "Routes to", "HTTP")
    
    Rel(legacy_monolith, legacy_db, "Reads/Writes")
    Rel(new_service_1, order_db, "Reads/Writes")
    Rel(new_service_1, cache, "Reads/Writes")
    Rel(new_service_2, cache, "Reads")
```

### System Context - IoT Platform
```mermaid
C4Context
    title System Context - Smart Home Platform
    
    Person(homeowner, "Homeowner", "Controls smart home devices")
    
    System(smart_home_hub, "Smart Home Hub", "Central control system")
    
    System_Ext(device_1, "Smart Lights", "Philips Hue")
    System_Ext(device_2, "Smart Thermostat", "Nest")
    System_Ext(device_3, "Security Camera", "Ring")
    System_Ext(voice_assistant, "Voice Assistant", "Amazon Alexa")
    System_Ext(weather_service, "Weather API", "Provides weather data")
    
    Rel(homeowner, smart_home_hub, "Controls via app")
    Rel(homeowner, voice_assistant, "Issues voice commands")
    
    Rel(smart_home_hub, device_1, "Controls", "Zigbee")
    Rel(smart_home_hub, device_2, "Controls", "WiFi")
    Rel(smart_home_hub, device_3, "Integrates with", "API")
    Rel(voice_assistant, smart_home_hub, "Sends commands to", "HTTPS")
    Rel(smart_home_hub, weather_service, "Gets weather from", "REST API")
```

### Component Diagram - Authentication Service
```mermaid
C4Component
    title Component Diagram - Authentication Service
    
    Container(web_app, "Web Application", "React")
    
    Component(auth_controller, "Auth Controller", "REST API", "Handles auth requests")
    Component(user_service, "User Service", "Business Logic", "User management")
    Component(token_service, "Token Service", "JWT", "Generates and validates tokens")
    Component(password_service, "Password Service", "bcrypt", "Hashes and verifies passwords")
    
    ComponentDb(user_repo, "User Repository", "Data Access", "Database access layer")
    
    Container_Ext(database, "PostgreSQL", "Database")
    Container_Ext(redis, "Redis", "Cache")
    
    Rel(web_app, auth_controller, "Calls", "HTTPS")
    Rel(auth_controller, user_service, "Uses")
    Rel(auth_controller, token_service, "Uses")
    Rel(user_service, password_service, "Uses")
    Rel(user_service, user_repo, "Uses")
    Rel(user_repo, database, "Reads/Writes", "SQL")
    Rel(token_service, redis, "Stores sessions", "Redis Protocol")
```

## Boundaries

```mermaid
C4Context
    title System with Boundaries
    
    Enterprise_Boundary(b0, "Company Boundary") {
        Person(customer, "Customer")
        
        System_Boundary(b1, "Internal Systems") {
            System(system1, "System 1")
            System(system2, "System 2")
        }
    }
    
    System_Ext(external, "External System")
    
    Rel(customer, system1, "Uses")
    Rel(system1, system2, "Depends on")
    Rel(system2, external, "Integrates with")
```

## Tips

- Start with System Context (highest level)
- Drill down to Containers for architecture overview
- Use Components for detailed service internals
- Keep diagrams focused on one level of abstraction
- Use boundaries to group related elements
- Include technology choices in Container diagrams
- Show external dependencies clearly
- Use consistent naming conventions
- Direction suffixes (_D, _U, _L, _R) control layout
- C4 model = Context, Containers, Components, Code
